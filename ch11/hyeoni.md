#11. 식별, 인가, 보안

## 11.1 개별 접촉
- HTTP는 익명이고 무상태(Stateless), 즉 연결 자체에 대한 정보를 갖지 않고 요청은 일회성이고 독립적으로 처리
- 서버는 사용자를 식별하거나 연속적인 요청을 추적하기 위해 약간의 정보를 이용할 수 있음
- 웹 사이트는 개인화된 서비스를 제공하고자 함
- 개별 인사: 온라인 쇼핑이 개인에게 맞춰져 있는 것처럼 느끼게 하려고 특화된 메세지나 페이지를 만듬
- 사용자 맞춤 추천: 고객의 흥미를 학습해서 좋아할법한 제품을 추천하거나, 기념일 등에 특별한 제품을 제시함
- 저장된 사용자 정보: 복잡한 주소, 신용카드 정보 등을 저장함
- 세션 추적: 무상태 속에서도 사용자와 사이트가 상호작용할 수 있게 상태를 남김 (장바구니 등)

## 11.2 HTTP 헤더
- From
    - 사용자의 이메일 주소를 포함
    - 이상적으로는 각 사용자가 다른 이메일을 사용
    - 악의적인 서버가 이메일 주소를 수집할 수 있어 브라우저는 From 헤더를 잘 보내지 않음
- User-Agent
    - 사용자가 쓰고 있는 브라우저의 이름과 버전 정보, 운영체제 정보 등을 기술
    - 사용자를 식별해내는데에는 별로 도움되지 않음
- Referer
    - 사용자가 현재 페이지로 유입하게 한 웹페이지의 URL을 가리킴
    - 사용자의 웹 사용 행태나 사용자의 취향을 더 잘 파악할 수 있음

## 11.3 클라이언트 IP 주소
- IP주소로 사용자를 식별하려면 사용자가 확실한 IP주소를 가지고 있고, 절대 바뀌지 않고, 웹 서버가 요청마다 클라이언트 IP를 알 수 있어야 함
- IP주소로 사용자를 식별하는 방식은 많은 약점을 가짐
    - 한 컴퓨터를 여러 사용자가 사용할 수 있는데, 그들을 식별할 수 없음
    - 인터넷 서비스 제공자(ISP)는 사용자에게 동적으로 IP주소를 할당하므로 매번 다를 수 있음
    - 많은 사용자가 네트워크 주소 변환 방화벽(NAT)을 사용하는데, 클라이언트 IP 주소는 숨기고 하나의 방화벽 IP 주소를 사용하게 됨
    - HTTP 프록시는 원 서버에 새로운 TCP연결을 하므로, 웹 서버는 클라이언트의 IP 주소 대신 프록시 서버의 IP 주소를 봄

## 11.4 사용자 로그인
- 웹 서버는 사용자 이름과 비밀번호로 인증(로그인)할 것을 요구해서 사용자에게 명시적으로 식별 요청을 할 수 있음
- WWW-Authenticate와 Authorization헤더 사용 (12장 참고)

## 11.5 뚱뚱한 URL
- 뚱뚱한 URL: 사용자의 상태 정보를 포함하고 있는 URL
- 사용자가 웹 사이트에 처음 방문하면 유일한 ID가 생성되고, 그 값은 모든 하이퍼링크에 추가되어 작동함
- 다음과 같은 문제가 있음
    - 못생긴 URL: 브라우저에 보이는 뚱뚱한 URL은 새로운 사용자들에게 혼란을 
    - 공유하지 못하는 URL: URL을 누군가에게 공유하면 개인 정보를 공유하는 것과 같음
- 캐시를 사용할 수 없음: URL이 달라지기 때문에 기존 캐시에 접근할 수 없음
- 서버 부하 가중: 서버는 뚱뚱한 URL에 해당하는 HTML 페이지를 다시 그려야 함
- 이탈: 사용자가 의도치않게 URL 세션에서 이탈하면 기존 진척상황들이 초기화됨
- 세션 간 지속성의 부재: 특정 뚱뚱한 URL을 사용자가 북마킹하지 않는 이상, 로그아웃하면 모든 정보를 잃음

## 11.6 쿠키
- 사용자를 식별하고 세션을 유지하는 방식 중에서 가장 널리 사용됨
- 쿠키 종류
    - 세션 쿠키: 설정과 신호 사항들을 저장하는 임시 쿠키. 브라우저를 닫으면 삭제됨
    - 지속 쿠키: 디스크에 저장되어 브라우저를 닫거나 컴퓨터를 재시작하더라도 남아있음
- 쿠키 동작 방식
    - 쿠키는 서버가 사용자에게 붙이는 스티커와 같음
    - Set-Cookie 혹은 Set-Cookie2같은 헤더로 임의의 이름=값형태의 리스트를 사용자에게 전달함
    - 브라우저는 해당 헤더에 있는 쿠키 컨텐츠를 브라우저 쿠키 데이터베이스에 저장함
    - 미래에 같은 사이트를 방문하면, 브라우저는 서버가 할당했던 쿠키를 Cookie 요청 헤더에 기술해 전송함
- 브라우저는 수많은 쿠키를 가지지만, 모든 사이트에 전부 보내지는 않음
- 쿠키를 모두 전달하려면 성능이 저하됨
- 쿠키 구성요소
    - Version 0 쿠키(넷스케이프 쿠키)
    - Version 1 쿠키(‘RFC 2965’): 널리 사용되지 않음
- 캐시되지 말아야 할 문서가 있다면 표시해야 됨
    - Cache-Control: no-cache="Set-Cookie를 기술해서 명확히 표시
- Set-Cookie 헤더를 캐시하는 것에 유의하라
    - 같은 Set-Cookie 헤더를 여러 사용자에게 보내면 사용자 추적에 실패할 수 있음
    - 어떤 캐시는 Set-Cookie 헤더를 제거하기 때문에 클라이언트는 헤더 정보가 없는 데이터를 받게될 수도 있음
    - Cache-Control: must-revalidate, max-age=0을 통해서 캐시에 대한 재검사가 항상 일어나게 할 수 있음

> 왜 쿠키라고 이름 붙였는지?
> - "쿠키"라는 용어는 웹 브라우저 프로그래머 루 몬툴리가 만들어냈다. 이는 유닉스 프로그래머들이 사용한, 프로그램이 수신 후 변경하지 않은 채로 반환하는 데이터의 패킷을 의미하는 매직 쿠키라는 용어에서 비롯된 것이다. [참고 위키백과](https://ko.m.wikipedia.org/wiki/HTTP_%EC%BF%A0%ED%82%A4)
