# 11. 클라이언트 식별과 쿠키

## 쿠키의 위험성은 과대평가?

쿠키의 위험성은 실제로 존재하지만, 종종 과장되거나 잘못 이해되는 경향이 있다.

쿠키는 물론 보안 위험이 있지만, 이는 관리 가능한 수준이며, 현대의 보안 메커니즘과 사용자 제어를 통해 충분히 완화될 수 있다. 

### **1. 쿠키의 역할**

- **세션 관리** : 로그인 상태를 유지하거나 장바구니에 제품을 저장하는 등의 기능을 한다.
- **사용자 맞춤화** : 사용자의 선호도를 기억하고 맞춤형 콘텐츠를 제공하는 데 사용된다.
- **추적 및 분석** : 웹사이트의 트래픽 분석과 사용자 행동 추적에 사용된다.

많은 사람들이 쿠키를 통해 모든 개인 정보가 노출될 수 있다고 오해할 수 있는데,

쿠키 자체는 단순히 데이터를 저장하는 도구일 뿐, 악성 소프트웨어가 아니기 때문에 사용자 컴퓨터에 직접적인 해를 끼치지 않는다.

또한, 사용자는 통제권을 갖고있어서 웹 브라우저를 통해 쿠키를 관리하고 제어할 수 있다.
- 특정 웹사이트의 쿠키를 차단하거나, 브라우저를 닫을 때 쿠키를 자동으로 삭제하도록 설정할 수 있다.

### **2. 쿠키 위험성 및 대응**

- **세션 하이재킹 (Session Hijacking)**
    - 쿠키는 종종 사용자의 로그인 상태를 유지하기 위해 사용된다. **공격자가 사용자의 세션 쿠키를 탈취**하면, 해당 사용자의 계정에 무단으로 접근할 수 있다.
    - **대응 방법** : HTTPS 사용, HttpOnly 쿠키 설정, 보안 쿠키(Secure) 플래그 사용.
        - **HttpOnly** : 쿠키가 JavaScript를 통해 접근되는 것을 방지. 이를 통해 XSS(교차 사이트 스크립팅) 공격을 줄일 수 있다.
        - **Secure** : 쿠키가 HTTPS 연결을 통해서만 전송되도록 보장. 이를 통해 전송 중에 데이터가 가로채지는 것을 방지한다.
- **크로스사이트 스크립팅 (XSS)**
    - **악성 스크립트**가 웹사이트에 삽입되어 쿠키를 탈취할 수 있다.
    - **대응 방법** : 입력 검증, 출력 인코딩, Content Security Policy(CSP) 사용.
- **크로스사이트 요청 위조 (CSRF)**
    - 공격자가 **사용자의 세션을 이용해 원하지 않는 요청을 서버에 보낼 수 있다.**
    - **대응 방법** : CSRF 토큰 사용, SameSite 쿠키 속성 설정.
        - **SameSite** : 쿠키가 제 3자 요청에서 전송되는 것을 제한하여 CSRF(교차 사이트 요청 위조) 공격을 방지.
- **추적 및 프라이버시 문제**
    - 쿠키는 사용자의 활동을 추적하는 데 사용될 수 있는데, 광고 네트워크는 이를 통해 **사용자 프로파일을 생성**할 수 있다.
    - **대응 방법** : 브라우저 프라이버시 설정, 추적 방지 확장 프로그램 사용, GDPR 등 법적 규제 준수.

### **3. 쿠키의 올바른 이해와 사용**

- **적절한 설정**
    - 쿠키를 설정할 때 Secure, HttpOnly, SameSite 등의 속성을 적절히 설정하여 보안을 강화할 수 있다.
- **프라이버시 보호**
    - 법적 규제를 준수하고, 사용자에게 쿠키 사용에 대한 명확한 정보를 제공하여 프라이버시를 보호할 수 있다.
- **보안 업데이트**
    - 웹 애플리케이션과 서버를 최신 보안 패치로 유지하여, 알려진 취약점을 방지할 수 있다.

<br>

## RFC 2965 폐기 (RFC 6265 HTTP State Management Mechanism 에 의해 폐기)

RFC 2965는 주로 웹 브라우저와 서버 간의 세션 관리를 위해 쿠키를 사용하는 방법을 정의하고 있었으나, 시간이 지남에 따라 RFC 2965의 **복잡성과 몇 가지 보안 문제**로 인해, 더 간단하고 안전한 쿠키 관리 메커니즘을 정의한 RFC 6265가 등장하게 되었다.

RFC 6265는 **단순성과 보안성을 강조**하여, 쿠키 관리의 **복잡성을 줄이고** **보안성을 강화**하는 데 기여하고 있다.

<br>

### **RFC 6265**

RFC 6265는 쿠키의 동작을 정의하는 표준을 단순화하고 명확히 하기 위해 작성되었다.

- **단순한 모델** : **구현의 복잡성을 줄이고**, 다양한 브라우저 간의 **호환성을 높이기 위한 목적**을 갖는다.
- **보안** : 보안 관련 문제를 해결하기 위해 몇 가지 중요한 지침을 포함한다.
    - `HttpOnly`와 `Secure` 플래그는 쿠키가 JavaScript에서 접근할 수 없도록 하고, HTTPS 연결에서만 전송되도록 한다.
- **명확한 사양** : 쿠키의 생성, 전송, 삭제에 관한 명확한 사양을 제공하여, 서버와 클라이언트 간의 일관된 동작을 보장한다.

### **RFC 2965와의 차이점**

1. **RFC 2965의 복잡성 감소** : RFC 2965는 여러 확장 기능과 복잡한 규칙을 포함하고 있어 구현과 사용이 어려웠는데, RFC 6265는 훨씬 간단해졌다.
2. **헤더 필드 축소** : RFC 2965에서는 `Set-Cookie2`와 `Cookie2` 헤더 필드를 정의했지만, RFC 6265에서는 단순히 `Set-Cookie`와 `Cookie` 헤더 필드만 사용한다. (Set-Cookie2, Cookie2 제거)
3. **쿠키 경로 처리** : RFC 6265는 쿠키의 경로 매칭 규칙을 단순화하여, 경로가 쿠키가 접근 가능한 경로의 접두사일 경우에만 쿠키를 전송하도록 한다.

<br>
