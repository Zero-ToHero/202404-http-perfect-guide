# 07. 캐시

## **광고 서비스 제공 업체와 캐시**

일반적으로 광고와 같은 동적 콘텐츠에 대한 캐싱은 다음과 같은 접근 방식으로 처리될 수 있다.
- **캐시 시간 설정 :** 광고 콘텐츠를 캐시하는 동안의 `유효 기간`을 설정.
        
    이 기간 동안 캐시된 콘텐츠를 사용하여 성능을 향상시킬 수 있다. 하지만 광고 업데이트 주기에 따라 적절한 시간을 선택해야 한다.
        
- **조건부 캐싱**: 광고 콘텐츠가 **변경되지 않은 경우**에만 캐시를 사용.
        
    이를 위해 HTTP 헤더를 사용하여 캐시 유효성을 검사하고, 콘텐츠가 변경되었는지 확인할 수 있다.
        
- **사용자별 캐싱**: 사용자마다 다른 광고를 제공해야 하는 경우, `사용자 식별 정보`를 기반으로 캐시를 관리. 
        
    이를 통해서, 각 사용자에게 적합한 광고를 제공하면서도 캐싱의 이점을 누릴 수 있다.
        
- **캐시 무효화**: **광고가 업데이트되거나 변경된 경우**, 관련된 캐시를 무효화하여 새로운 콘텐츠를 가져오도록 강제할 수 있다.
- **에지(Edge) 캐싱**: 광고 콘텐츠를 **전 세계의 다양한 위치에 캐시**하여 **지연 시간을 최소화**할 수 있다. `CDN(Content Delivery Network)`을 사용하여 이를 구현할 수 있다.
    - **광고 전송 최적화**
        - 광고 콘텐츠의 **로딩 속도를 향상**시키고 사용자에게 더 나은 사용자 경험을 제공할 수 있다.
    - **광고 캐싱**
        - 광고 서비스 업체는 광고 콘텐츠를 CDN과 같은 캐시 서버에 저장하여 **지역적으로 캐싱**함으로써 사용자에게 더 빠르게 제공할 수 있다.
        - 사용자가 웹 페이지를 방문할 때, CDN은 **해당 지역에 캐시된 광고 콘텐츠를 제공**하여 더 나은 성능을 제공한다.
    - **광고 수익 최적화**
        - 광고 콘텐츠의 전송 속도 향상으로, 사용자에게 광고를 빠르게 제공함으로써 광고 수익을 최적화할 수 있다. (빠른 광고 로딩은 사용자가 광고를 클릭하거나 상호작용할 가능성을 높일 수 있기 때문.)

<br>

### 사용자의 개별 조회 횟수 추적

광고 캐싱은 일반적으로 광고 제공 업체가 사용자의 상호 작용 및 조회 기록을 추적하는 데에 사용되지는 않고, `사용자의 개별 조회 횟수`를 추적하기 위해 다양한 메커니즘을 사용할 수 있다.

- **쿠키**: 광고 서비스는 사용자의 **브라우저에 쿠키를 설정**하여 광고 조회 및 상호 작용 기록을 추적할 수 있다.
- **사용자 식별자**: **사용자를 식별하는 고유한 식별자**를 사용하여 광고 조회 횟수를 추적할 수 있다.
- **IP 주소**: **사용자의 IP 주소를 사용**하여 광고 조회 횟수를 추적할 수 있다. 그러나 동적 IP 할당 및 VPN을 사용하는 경우 이 메커니즘의 정확성이 제한될 수 있다.
- **디바이스 식별자**: 모바일 앱이나 기기에서 사용되는 **고유한 식별자**를 사용하여 광고 조회 횟수를 추적할 수 있다.
    - iOS → IDFA (Identifier for Advertisers)
    - Android → ADID (Google Advertising ID)

그러나 개인 정보 보호와 관련된 이슈를 고려하여 이러한 메커니즘이 사용되는 방식이 규제될 수 있다.

- e.g.) 모바일 앱에서는 각 플랫폼별 광고 식별자에 접근하기 위해서는 아래 권한을 사용자에게 받아야 하며, 사용자가 **거부할 경우 해당 기능에 접근할 수 없다.**
    - **Android** : ADID에 접근하기 위해 `com.google.android.gms.permission.AD_ID` 권한 설정 추가.
    - **iOS** : IDFA에 접근하기 위해 `NSUserTrackingUsageDescription` 추가 후 AppTrackingTransparency프레임워크를 통해 권한 요구.

<br>

## 고성능 캐시가 로컬 저장장치와 네트워크 I/O 버퍼 사이에서 문서의 콘텐츠 복사를 피함으로써 데이터를 효과적으로 전송하기 위해 노력한다

일반적으로 데이터를 전송할 때는, 데이터가 `소스(웹 서버)`에서 `목적지(클라이언트)`로 복사되어야 한다.

이 과정에서 데이터는 여러 단계를 거치며 복사되고 이동하게 된다.

- 웹 서버에서 클라이언트로 데이터를 보낼 때는 다음과 같은 과정이 발생
    1. 웹 서버에서 데이터를 **로컬 저장장치에 저장**
    2. 데이터가 저장되어 있는 로컬 저장장치에서 **네트워크 I/O 버퍼로 복사**
    3. 네트워크 I/O 버퍼에서 **클라이언트로 데이터가 복사**

이러한 과정에서 데이터가 **여러 번 복사되고 이동**하므로,

이러한 오버헤드를 최소화하기 위해 캐시는 데이터를 가능한 한 로컬 저장장치와 네트워크 I/O 버퍼 사이에서 복사하지 않고 `직접 전송`한다.

이렇게 하면 데이터 이동과 전송 과정에서 생기는 오버헤드를 줄일 수 있으며, 전송 속도를 높일 수 있다.