# [HTTP] 8회차 (ch15)

## 15장 엔터티와 인코딩

- HTTP는 수많은 미디어 객체를 실어 나른다.
- HTTP 이러한 콘텐츠를 잘 전송하기 위해 아래와 같은 것들을 보장한다.
  - Content-Type, Content-Language 헤더를 통해서 콘텐츠 똑바로 처리 가능
  - Content-Length, Content-Encoding 헤더를 통해서 압축 똑바로 풀 수 있음.
  - 객체는 항상 최신.
  - 사용자 요구를 만족시킬 것이다. (Accept 관련 헤더)
  - 네트워크 사이를 신속하게 효율적으로 이동할 것이다. (범위 요청, 델타 인코딩, 데이터 압축)
  - 조작되지 않고 온전하게 도착할 것이다 (전송 인코딩 헤더와 Content-MD5 체크섬 이용)
- 이를 위해 HTTP는 잘 라벨링된 엔터티 사용함.

### 메시지는 그릇, 엔터티는 내용물

- 메시지에 엔터티가 포함된다.
  - 엔터티는 헤더와 바디로 구성된다.
    - 바디에는 가공되지 않은 데이터가 담긴다.
    - 나머지 정보들은 모두 헤더에 있다.

### Content-Length

- Content-Length 헤더는 메시지의 엔터티 본문의 크기를 byte로 나타낸다.
- 인코딩 방법에 상관없이 크기를 표현할 수 있다.
- 압축된 이후의 크기를 나타낸다.
- 예전에는 커넥션 닫히는 것이 곧 메시지의 끝을 의미했다.
  - 하지만 이 방법으로는 충돌 발생 여부를 판단하지 못했다.
  - 이 때문에 콘텐츠의 크기를 명시하는 것을 통해서 메시지의 끝을 파악하게 되었다.

### Content-Encoding

- 보안 강화 or 공간 절약 목표
- Content-Length 헤더는 인코딩 이후의 본문의 길이를 byte단위로 정의함.

### 엔터티 요약

- 엔터티 본문에 대한 데이터의 변경을 감시하기 위해서 최초 엔터티가 생성될 때 송신자는 데이터에 대한 체크섬을 생성할 수 있다.
- 수신자는 체크섬을 이용해서 엔터티에 변경이 있었는지를 검사할 수 있다.
- Content-MD5 헤더는 서버가 엔터티 본문에 MD5 알고리즘을 적용한 결과를 보내기 위해 사용된다.

### 미디어 타입과 Charset

- Content-Type 헤더는 `엔터티 본문`의 MIME 타입을 기술한다.
- 콘텐츠를 적절히 해독하고 처리하기 위해서 MIME 타입 이용
  - MIME 타입은 표준화된 타입이다.

```
Content-Type: text/html; charset=utf-8
```

- 이렇게 되면 html 형식의 텍스트 파일이며, 문자집합은 utf-8이다.
- 멀티파트 미디어 타입
  - 여러 구성요소들이 이어져있고, 문자열 하나로 서로의 경계를 나타낸다.

### 콘텐츠 인코딩

- 과정
  1. 웹 서버가 원본 Content-Type과 Content-Length 헤더를 수반한 원본 응답 생성
  2. 콘텐츠 인코딩 서버가 인코딩된 메시지 생성. (Content-Length가 다르다.)
  3. 콘텐츠 인코딩 서버가 Content-Encoding 헤더를 인코딩된 메시지에 추가. (수신 측에서 그걸 디코딩할 수 있도록.)
  4. 디코딩하고 원본 읽는다.
- 인코딩 역시 마찬가지로 Accept-Encoding 헤더를 통해서 인코딩 방법을 제한할 수 있다.

### 전송 인코딩과 청크 인코딩

- 안전한 전송을 위해서 전송 인코딩한다.
  - 전송 인코딩을 제어하기 위한 헤더. Tranfer-Encoding 에 인코딩 방법을 메시지에 적어놨습니다

### 청크 인코딩

- 전송 인코딩의 한 일종이다.
- 이를 이용하면 메시지를 보내기 전에 전체 크기를 알지 않아도 된다.
- 본문이 동적으로 생성되면 서버는 그중 일부를 버퍼에 담을 수 있다.

```
메시지는 엔터티를 담는 그릇
엔터티 = 헤더 + 본문
```

- 클라와 서버의 커넥션이 지속적이라면 본문의 크기를 알 필요가 없다. 커넥션 닫힐 때까지를 본문으로 생각했을꺼야.
- 서버가 본문을 여러 청크로 쪼개 보낼 수 있게 해줌.
- 크기가 0인 청크로 본문이 끝났음을 알리고 다음 응답을 위해 커넥션을 열린채로 유지한다.

==메시지 = 헤더 + 본문==

### 범위 요청

- 클라가 문서의 일부분 or 특정 범위는 요청할 수 있도록 한다.

### 델타 요청

- 새 페이지 전체 대신, 변경된 부분만을 보내서 전송량을 최적화하는 HTTP 프로토콜의 확장.
- 어떤 버젼인지, 어떤 알고리즘인지를 서버에 전달해야한다.
  - 버젼: If-None-Match 헤더
  - 알고리즘: A-IM 헤더
